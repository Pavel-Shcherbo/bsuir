!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./Javascript.SDK/Modules/Helpers/entry.ts")}({"./Javascript.SDK/Modules/Helpers/Module.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("./Javascript.SDK/Modules/Helpers/commands/checkProductSegment/checkProductSegments.ts"),n=r("./Javascript.SDK/Modules/Helpers/commands/getDeviceUUID/getDeviceUUID.ts");t.HelpersModule={checkProductSegments:function(e,t,r){return o.checkProductSegments(r)},getDeviceUUID:function(e,t,r){return n.getDeviceUUID(t,r)}}},"./Javascript.SDK/Modules/Helpers/ModuleInfo.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.helpersModuleInfo={name:"helpers",src:"helpers.js",version:"0.0.1",isSupportedByBrowser:function(){return!0},requiresSdkInitialization:function(){return!1}}},"./Javascript.SDK/Modules/Helpers/commands/checkProductSegment/cacheWithExpiry.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,r){this.dateTimeMs=t,this.expiryMs=e,this.storage=r?JSON.parse(r):{},this.purge()}return e.prototype.purge=function(){var e=this.dateTimeMs();for(var t in this.storage){if(this.storage.hasOwnProperty(t))this.storage[t].expiry<e&&delete this.storage[t]}},e.prototype.get=function(e){var t=this.storage[e];if(t){if(!(t.expiry<this.dateTimeMs()))return t.value;delete this.storage[e]}},e.prototype.set=function(e,t){var r={expiry:this.dateTimeMs()+this.expiryMs,value:t};this.storage[e]=r},e.prototype.serialize=function(){return JSON.stringify(this.storage)},e}();t.CacheWithExpiry=o},"./Javascript.SDK/Modules/Helpers/commands/checkProductSegment/checkProductSegments.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("./Javascript.SDK/Modules/Helpers/commands/checkProductSegment/cacheWithExpiry.ts");t.getProductOrGroupKey=function(e){return JSON.stringify(e.ids).toLowerCase()},t.getSegmentationKey=function(e){return e.ids.externalId.toLowerCase()},t.getCacheKey=function(e,r){return e+t.getSegmentationKey(r)},t.toCacheKeyCollectionIdMap=function(e,t){for(var r={},o=0;o<e.length;o++){r[t(e[o])]=o}return r},t.buildRequestData=function(e,r,o,n,s){var u={products:[],productGroups:[],segmentations:[]},i=[],c=[],a={},p={},d={},l={};if(null!=o&&o.length>0){var g=t.buildRequestDataFor(e,o,s,(function(e){return{product:e,segmentations:[]}}));u.products=g.requestProductsOrGroups,u.segmentations=g.requestSegmentations,i=g.responseFromCache,a=t.toCacheKeyCollectionIdMap(o,t.getProductOrGroupKey),l=g.requestedSegmentations}if(null!=n&&n.length>0){var m=t.buildRequestDataFor(r,n,s,(function(e){return{productGroup:e,segmentations:[]}}));u.productGroups=m.requestProductsOrGroups;for(var f=0;f<m.requestSegmentations.length;f++){var h=m.requestSegmentations[f];l[t.getSegmentationKey(h)]||u.segmentations.push(h)}c=m.responseFromCache,p=t.toCacheKeyCollectionIdMap(n,t.getProductOrGroupKey)}return null!=s&&s.length>0&&(d=t.toCacheKeyCollectionIdMap(s,t.getSegmentationKey)),{request:u,productResponseFromCache:i,productGroupResponseFromCache:c,productOrderMap:a,productGroupOrderMap:p,segmentationOrderMap:d}},t.buildRequestDataFor=function(e,r,o,n){for(var s=[],u=[],i=[],c={},a=0;a<r.length;a++){var p=r[a],d=t.getProductOrGroupKey(p);i[a]||(i[a]=n(p));for(var l=!1,g=0;g<o.length;g++){var m=o[g],f=t.getSegmentationKey(m),h=t.getCacheKey(d,m),v=e.get(h);void 0===v?(l=!0,c[f]||(u.push(m),c[f]=!0)):v&&(i[a].segmentations[g]={ids:m.ids,segment:v})}l&&s.push(p)}return{requestProductsOrGroups:s,requestSegmentations:u,responseFromCache:i,requestedSegmentations:c}},t.buildCompleteResponse=function(e,r,o,n){var s=[];s=(s=s.concat(o.productResponseFromCache)).concat(o.productGroupResponseFromCache),null!=n.products&&n.products.length>0&&t.buildCompleteResponseFor(e,o.productResponseFromCache,n.products,o.productOrderMap,o.segmentationOrderMap),null!=n.productGroups&&n.productGroups.length>0&&t.buildCompleteResponseFor(r,o.productGroupResponseFromCache,n.productGroups,o.productGroupOrderMap,o.segmentationOrderMap);for(var u=0;u<s.length;u++){for(var i=[],c=0;c<s[u].segmentations.length;c++){var a=s[u].segmentations[c];a&&i.push(a)}s[u].segmentations=i}return{productCache:e,productGroupCache:r,response:s}},t.buildCompleteResponseFor=function(e,r,o,n,s){for(var u=0;u<o.length;u++)for(var i=o[u],c=t.getProductOrGroupKey(i),a=r[n[c]],p=0;p<i.segmentations.length;p++){var d=i.segmentations[p],l=t.getSegmentationKey(d),g=t.getCacheKey(c,d);e.set(g,d.segment||null),a.segmentations[s[l]]=d.segment?d:void 0}},t.checkProductSegments=function(e){var r,n,s,u,i,c;if((null!==(u=null!==(n=null===(r=e.products)||void 0===r?void 0:r.length)&&void 0!==n?n:0+(null===(s=e.productGroups)||void 0===s?void 0:s.length))&&void 0!==u?u:0)>50)return Promise.reject(new Error("Too many products and product groups for a single call"));if(e.segmentations.length>10)return Promise.reject(new Error("Too many segmentations for a single call"));var a="MindboxProductSegmentsCache",p="MindboxProductGroupSegmentsCache",d=new o.CacheWithExpiry(3e5,Date.now,window.localStorage.getItem(a)),l=new o.CacheWithExpiry(3e5,Date.now,window.localStorage.getItem(p)),g=t.buildRequestData(d,l,e.products,e.productGroups,e.segmentations);if(0==(null===(i=g.request.products)||void 0===i?void 0:i.length)&&0==(null===(c=g.request.productGroups)||void 0===c?void 0:c.length)){var m=t.buildCompleteResponse(d,l,g,{products:[],productGroups:[]});return new Promise((function(t,r){e.onSuccess(m.response),t()}))}return new Promise((function(r,o){window.mindbox("sync",{operation:"Tracker.CheckProductSegments",data:g.request,onError:function(t){e.onError(t),o(t)},onSuccess:function(o){var n=t.buildCompleteResponse(d,l,g,o);window.localStorage.setItem(a,n.productCache.serialize()),window.localStorage.setItem(p,n.productGroupCache.serialize()),e.onSuccess(n.response),r()}})}))}},"./Javascript.SDK/Modules/Helpers/commands/getDeviceUUID/getDeviceUUID.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDeviceUUID=function(e,t){return t(e),Promise.resolve()}},"./Javascript.SDK/Modules/Helpers/entry.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("./Javascript.SDK/Modules/Helpers/Module.ts"),n=r("./Javascript.SDK/Modules/Helpers/ModuleInfo.ts");r("./Javascript.SDK/Tracker/v1/GlobalTypes.ts"),window.mindbox[n.helpersModuleInfo.name]=o.HelpersModule},"./Javascript.SDK/Tracker/v1/GlobalTypes.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}});